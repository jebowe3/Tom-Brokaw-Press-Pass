<!DOCTYPE html>
<html lang="en">

<head>
  <title>StoryMapJS: Tom Brokaw Press Pass</title>
  <meta charset="utf-8">
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@knightlab" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Tom Brokaw Press Pass" />
  <meta property="og:description" content="">
  <meta property="og:image" content="https:///staticimg/logos/logo_storymap.png" />
  <meta property="og:site_name" content="StoryMapJS" />
  <meta name="description" content="">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-touch-fullscreen" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <link rel="shortcut icon" href="src/favicon.ico">
  <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="anonymous" referrerpolicy="no-referrer" />-->
  <!-- Load KnightLab StoryMap CSS -->
  <link rel="stylesheet" href="https://cdn.knightlab.com/libs/storymapjs/latest/css/storymap.css">
  <!-- css for control window -->
  <link rel="stylesheet" href="src/L.Control.Window.css">
  <!-- css for search bar (https://github.com/stefanocudini/leaflet-search) -->
  <link rel="stylesheet" href="src/leaflet-search.css" />
  <!-- Lite YouTube Embed (Improves page loading time by preventing loading of YouTube videos until clicked)
  https://github.com/paulirish/lite-youtube-embed -->
  <link rel="stylesheet" href="src/lite-yt-embed.css" />
  <!-- Load font css -->
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@700&display=swap" rel="stylesheet">
  <!-- Define page css -->
  <style>
    html,
    body {
      width: 100%;
      min-height: 100%;
      padding: 0;
      margin: 0;
    }

    #wrapper {
      padding:75px 0 0 0;
      position:absolute;
      top:0;
      bottom:0;
      left:0;
      right:0;
    }

    header {
      position: relative;
      margin-top: -75px;
      height: 75px;
      width: 100%;
      background-color: white;
      box-shadow: 0px 3px 3px black;
      z-index: 800;
    }

    #logobox {
      float: left;
      height: inherit;
      width: 38%;
      cursor: pointer;
    }

    .uiowa-logo {
      height: 100%;
      margin-left: 2.5%;
    }

    #expbox {
      float: right;
      height: inherit;
      width: 62%;
    }

    h1 {
      /*font-family: 'Roboto', sans-serif;*/
      font-family: 'Lato', sans-serif;
      display: inline-block;
      color: black;
      font-size: 1.75em;
      margin-top: 0.75em;
      margin-bottom: 0px;
      margin-left: 5%;
    }

    #mapdiv {
      /*border: 1px solid #999;*/
      min-height: 100%;
    }

    .vco-menubar {
      top: 0px;
      line-height: 30px;
      box-shadow: 0px 0px 0px 1px rgba(0, 0, 0, 0.3);
    }

    .button {
      position: absolute;
      bottom: 25px;
      left: 145px;
      line-height: 25px;
      box-shadow: 0px 0px 0px 1px rgba(0, 0, 0, 0.3);
      background-color: white;
      font-family: 'PT Sans', sans-serif;
      text-transform: none;
      font-size: 14px;
      cursor: pointer;
      padding-bottom: 3px;
      z-index: 1011;
      text-align: left;
      overflow: hidden;
      border-bottom: 1px solid #e6e6e6;
      border-right: 1px solid #e6e6e6;
      border-left: 1px solid #e6e6e6;
      border-bottom-right-radius: 7px;
      border-bottom-left-radius: 7px;
      border-top-right-radius: 7px;
      border-top-left-radius: 7px;
      color: #737373;
      font-weight: bold;
    }
    .button:hover {
      background-color: #c4442c;
      color: white;
    }

    .button2 {
      position: absolute;
      bottom: 25px;
      left: 10px;
      line-height: 25px;
      box-shadow: 0px 0px 0px 1px rgba(0, 0, 0, 0.3);
      background-color: white;
      font-family: 'PT Sans', sans-serif;
      text-transform: none;
      font-size: 14px;
      cursor: pointer;
      padding-bottom: 3px;
      z-index: 1011;
      text-align: left;
      overflow: hidden;
      border-bottom: 1px solid #e6e6e6;
      border-right: 1px solid #e6e6e6;
      border-left: 1px solid #e6e6e6;
      border-bottom-right-radius: 7px;
      border-bottom-left-radius: 7px;
      border-top-right-radius: 7px;
      border-top-left-radius: 7px;
      color: #737373;
      font-weight: bold;
    }
    .button2:hover {
      background-color: #c4442c;
      color: white;
    }

    @media only screen and (max-width: 1200px) {

      h1 {
        font-size: 1.5em;
        margin-top: 1.0em;
      }

    }

    @media only screen and (max-width: 1000px) {

      .uiowa-logo {
        height: 100%;
      }

      h1 {
        font-size: 1.35em;
        margin-top: 1.15em;
      }

    }

    @media only screen and (max-height: 400px) {
      .vco-slide-calltoaction {
        visibility: hidden;
      }
    }

    @media only screen and (max-width: 900px) {
      h1 {
        font-size: 1.15em;
        margin-top: 1.35em;
      }
    }

    @media only screen and (max-width: 800px) {

      #wrapper {
        padding:60px 0 0 0;
      }

      header {
        margin-top: -60px;
        height: 60px;
      }

      #logobox {
        width: 40%;
      }

      .uiowa-logo {
        height: 100%;
      }

      #expbox {
        width: 60%;
      }

      h1 {
        font-size: 1.0em;
        margin-top: 1.25em;
      }

    }

    @media only screen and (max-width: 500px) {

      #wrapper {
        padding:40px 0 0 0;
      }

      header {
        margin-top: -40px;
        height: 40px;
      }

      #logobox {
        width: 40%;
      }

      h1 {
        font-size: 0.75em;
        margin-top: 0.50em;
      }

    }

    @media only screen and (max-width: 400px) {

      #wrapper {
        padding:35px 0 0 0;
      }

      header {
        margin-top: -35px;
        height: 35px;
      }

      h1 {
        height: 0.6em;
        font-size: 0.5em;
        margin-top: 1.6em;
      }

    }

    @media only screen and (max-width: 361px) {
      h1 {
        height: 0.5em;
        font-size: 0.5em;
        margin-top: 1.65em;
      }
    }

  </style>
  <!-- HTML5 shim, for IE6-8 support of HTML elements-->
  <!--[if lt IE 9]>
<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>

<body>
  <div id="wrapper">
    <!-- the header -->
    <header>
        <div id="logobox">
          <img class="uiowa-logo" src="files/uiowa-logo/University-Libraries-LockupHorizontal-RGB.png">
        </div>
        <div id="expbox">
          <h1 style="text-transform:uppercase;">tom brokaw's travels through press passes</h1>
          <br>
        </div>
    </header>
    <!-- the map -->
    <div id="mapdiv">
      <input class="button" type="button" onclick="window.open('files/video/BrokawClip2_compressed.mp4');" value="Words from Brokaw" />
      <input id="button2" class="button2" type="button" value="About this Project" />
    </div>
  </div>
  <!--<script src='https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js'></script>-->
  <!-- Load KnightLab's StoryMap JavaScript -->
  <script type="text/javascript" src="https://cdn.knightlab.com/libs/storymapjs/latest/js/storymap-min.js"></script>
  <!-- css for search bar (https://github.com/stefanocudini/leaflet-search) -->
  <script src="src/leaflet-search.js"></script>
  <!-- Lite YouTube Embed (Improves page loading time by preventing loading of YouTube videos until clicked)
  https://github.com/paulirish/lite-youtube-embed -->
  <script src="src/lite-yt-embed.js"></script>
  <!-- control window support -->
  <script src='src/L.Control.Window.js'></script>

  <script>
    var storymap;
    var storymap_url = 'published.json';
    const urlParams = new URLSearchParams(window.location.search);

    function onStoryMapTitle(e) {
      document.title = "StoryMapJS: " + e.title;
    };

    function getScriptPath(scriptname) {
      var scriptTags = document.getElementsByTagName('script');
      for (var i = 0; i < scriptTags.length; i++) {
        if (scriptTags[i].src.match(scriptname)) {
          script_path = scriptTags[i].src;
          return script_path.split('?')[0].split('/').slice(0, -1).join('/');
        }
      }
      return '';
    }

    function getStartSlide() {
      var slide = 0;
      if (urlParams.has('start_at_slide')) {
        slide = parseInt(urlParams.get('start_at_slide'), 10);
      }
      return slide;
    }

    function urlJoin(url, concat) { // see http://stackoverflow.com/questions/2676178/joining-relative-urls
      function build(parts, container) {
        for (var i = 0, l = parts.length; i < l; i++) {
          if (parts[i] == '..') {
            container.pop();
          } else if (parts[i] == '.') {
            continue;
          } else {
            container.push(parts[i]);
          }
        }
      }
      var url_parts = [];
      build(url.split('/'), url_parts);
      build(concat.split('/'), url_parts);
      return url_parts.join('/');
    }

    function buildStoryMap(data) {
      if (!data || !data.storymap) {
        return;
      }
      var options = {
        script_path: getScriptPath(/storymap(-min)?\.js/),
        start_at_slide: getStartSlide()
      };
      var font = "stock:default";
      if (data.font_css) {
        font = data.font_css;
      }
      if (font.indexOf("stock:") == 0) {
        var font_name = font.split(':')[1];
        var base_url = urlJoin(options.script_path, "../css/fonts");
        font = urlJoin(base_url, "font." + font_name + ".css");
      } else if (!font.match('^(http|https|//)')) {
        font = urlJoin(options.script_path, font);
      }
      KLStoryMap.loadCSS(font, function() {
        console.log('font loaded: ' + font);
      });
      storymap = new KLStoryMap.StoryMap('mapdiv', data, options, {
        title: onStoryMapTitle
      });
      var mapType = storymap.options.map_type;
      if (mapType && mapType.match('^zoomify.*')) {
        ga('send', 'event', 'StoryMapJS', 'zoomify', document.referrer)
      }
    }

    // In this function, you can access the data in the published.json file and the map
    (function() {
      fetch(storymap_url)
        .then(response => response.json())
        .then(data => {
          buildStoryMap(data);

          // Define an empty geojson file to which you will add the data from the slides.
          // It is necessary to create a Leaflet layer from this data because the search control requires a Leaflet layer.
          var SlidesLayer = {
            "type": "FeatureCollection",
            "name": "SlidesLayer",
            "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
            "features": []
          };

          // Define the slides data
          var slides = data.storymap.slides;

          // Iterate through each slide
          for(var i in slides) {
            // Avoid pushing data from the intro slide
            if (slides[i].location.lon != null) {
              var hline = slides[i].text.headline; // This is the headline
              var content = slides[i].text.text; // This is the descriptive text and videos
              var date = content.split("<br>")[0]; // This is the date taken from the content
              var lat = slides[i].location.lat; // This is the latitude of the point
              var lon = slides[i].location.lon; // This is the longitude of the point
              // Push the data into the empty geojson defined above
              SlidesLayer.features.push({
                "type": "Feature",
                "properties": {
                  "headline": hline, // This is not required, but we may want it later
                  "text": content, // This is not required, but we may want it later
                  "filterprop": hline + '; ' + date // This is required. The search control will search this data
                },
                "geometry": {
                  "type": "Point",
                  "coordinates": [ lon, lat ] // This is required
                }
              });
            }
          };

          // THE MAP - This is IMPORTANT because it was hard to find and we need it for adding controls
          var map = storymap.map;

          // Create a Leaflet layer from the geojson file created above
          var sLayer = L.geoJson(SlidesLayer);

          // Create the search control and add it to the map
          var searchControl = new L.Control.Search({
            layer: sLayer, // Run the search on the sLayer Leaflet layer defined above
            propertyName: 'filterprop', // Use the filterprop attribute for searching
            initial: false, // IMPORTANT!! - If this is not set to false, the control will limit searches to exact initial characters
            marker: false
          }).addTo(map);

          // Make sure to remove the Leaflet layer from the map so that it does not produce markers over the markers already in the map
          map.removeLayer(sLayer);

          // IMPORTANT!! We need this event to trigger clicks on the appropriate map markers.
          // This will take us to the correct slide using the search control.
          searchControl.on('search:locationfound', function(e) { // When a match is selected in the search bar...
            (document.querySelector('[title="'+e.text.split('; ')[0]+'"]')).click(); // Click the marker with the matching title
          });

        });
    })();

    window.onresize = function(event) {
      if (storymap) {
        storymap.updateDisplay();
      }
    };

    // This is the button that triggers the info about the project
    var infoButton = document.getElementById('button2');

    // When this button is clicked...
    infoButton.onclick = function(){
      // Open the window with the following information
      L.control.window(mapdiv,{maxWidth:500,modal:true})
                .title('About this Project')
                .content('<b>Project Overview</b><br><q>A trove of press passes</q> was the scribbled note attached to a worn blue Pan-Am bag stuffed with press passes when Tom Brokaw donated his papers to the University of Iowa Libraries in 2016.<br><br>These passes stretched across five decades of national and international events, documenting the career of an award-winning journalist.<br><br>The following digital exhibit utilizes these passes to explore a timeline of events that Tom Brokaw witnessed and reported on throughout his career. Here is a chance to view journalism through the lens of a journalist, while also exploring the role of journalism in telling our history.<br><br><b>Credits</b><br>This project was made possible through the efforts of <b>Patrick Johnson</b>. Patrick came to Special Collections & Archives in the summer of 2021 as a Humanities for the Public Good Intern. Under the guidance of Elizabeth Riordan at the University of Iowa Libraries, Patrick’s enthusiasm for journalistic history moved this project forward to what it is today.<br><br>As Patrick wrote, <q>Journalism is seen as the first draft of history. It is through journalistic works that we often come to know and learn about the world and the people around us. Journalism defines our collective memory. What Brokaw did was tell a draft of history that defined a generation. In some respects...this project can serve as a second draft—a history of a history.</q><br><br>Thank you also to <b>Ben Wootton</b> for research support, and to <b>Jay Bowen</b> for sharing his expertise in StoryMapJS to get the project online and running smoothly.<br><br>Of course, this project could not have happened without <b>Tom Brokaw</b>, who offered not only his papers to Special Collections & Archives, but also his time and stories. Special thanks is also needed for <b>Geri Jansen</b>, who helped navigate our questions; without her help this project would not have been completed.<br><br>Thank you also to <b>John Culshaw</b>, <b>Margaret Gamm</b>, <b>Tom Keegan</b>, <b>Elizabeth Riordan</b>, <b>Beth Stone</b>, <b>Bethany Davis</b>, and <b>Justin Baumgartner</b> for their help and support.<br><br><img src="files/extra/trove.jpg" alt="Trove" width="100%"> ')
                //.prompt({callback:function(){alert('This is called after OK click!')}})
                .show()
    };

    document.getElementById('logobox').addEventListener('click', function (e) {
      e.preventDefault();
      window.open('https://www.lib.uiowa.edu/', '_blank');
    });

  </script>

</body>

</html>
